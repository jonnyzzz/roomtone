# Penetration Testing (Auth Mode)

Roomtone includes a lightweight pentest harness for the auth-protected HTTP
server. It runs the server locally in auth mode, verifies that unauthenticated
requests are rejected, and then scans the service with the OWASP ZAP baseline
container.

## Quick Run

```bash
./scripts/pentest-auth.sh
```

Reports are written to `pentest/`:
- `pentest/zap-report.html`
- `pentest/zap-report.json`
- `pentest/server.log`

## What It Checks

- HTTP requests without a JWT return `401`.
- Static assets are not served without a token.
- ZAP baseline scan runs against an authenticated entry point.

## Parameters

The script supports environment overrides:

| Variable | Default | Purpose |
| --- | --- | --- |
| `PORT` | `5670` | Local port for the server |
| `BASE_URL` | `http://127.0.0.1:$PORT` | Base URL for preflight checks |
| `ZAP_IMAGE` | `ghcr.io/zaproxy/zaproxy:stable` | OWASP ZAP Docker image |
| `ZAP_NETWORK` | `host` | Docker network for ZAP |
| `ZAP_TARGET` | `BASE_URL` | Target URL for ZAP scan |
| `ZAP_REPORT_DIR` | `./pentest` | Output directory for reports |

## Notes

- The script generates a temporary RSA keypair and JWT, then starts the server
  with `AUTH_ENABLED=true` and `ALLOW_INSECURE_HTTP=true` (HTTP-only for local
  scanning; HTTPS is terminated externally in production).
- On macOS/Windows, Docker does not support `--network host`. Use:

```bash
ZAP_NETWORK=bridge \
ZAP_TARGET=http://host.docker.internal:5670 \
./scripts/pentest-auth.sh
```
