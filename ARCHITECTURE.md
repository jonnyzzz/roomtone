# Architecture

Roomtone is a single-room mesh call. Each browser connects to the signaling server over WebSocket, then establishes direct WebRTC peer connections to every other participant.

## Components

- Browser UI (React + TypeScript)
- Signaling server (Node.js + Express + ws)
- Optional Telegram bot (JWT invite issuer)
- Optional notification paths (browser notifications + Telegram join notices)

## Data Flow

```
+-----------+          WebSocket           +-----------------+
|  Browser  |  <------------------------>  |  Node Signaling |
+-----------+                               +-----------------+
      |                                               |
      |   WebRTC peer connections (mesh)              |
      +-----------------+-----------------------------+
                        |
                +---------------+
                |  Other peers  |
                +---------------+
```

Media flows directly between peers using host candidates only.

## Optional Bot Flow

The Telegram bot is a separate process that signs short-lived JWT invite links
for allowlisted Telegram users. The browser loads the link, which provides the
token to the server for authentication.

When join notifications are enabled, the bot periodically polls the server's
`/participants` endpoint and posts a short message (with a compact join link)
to configured chats.

## Signaling Messages

All clients join the same room. The server tracks participant IDs and forwards signaling payloads.

- `join` -> client sends name, server responds with `welcome`.
- `peer-joined` -> server notifies existing peers to create offers.
- `signal` -> clients exchange SDP offers/answers and ICE candidates.
- `peer-left` -> server notifies peers to clean up.

## Room Model

There is exactly one room. Participant IDs are generated by the server. Names are provided by the client and limited to 40 characters.

## Scaling Notes

This project uses mesh WebRTC: every participant connects directly to every other participant. For 10 participants, each client can have up to 9 peer connections. For larger rooms or lower-powered devices, an SFU (Selective Forwarding Unit) would be the next step.
